<!-- ===========================
     FILE: public/flappybingus.html
     =========================== -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Flappy Bingus</title>
  <style>
    :root{
      --bg0:#0e0822;
      --bg1:#1a0e38;
      --glass-edge:rgba(255,255,255,.24);
      --panel:rgba(22,13,52,.7);
      --panel2:rgba(44,24,88,.54);
      --panel-soft:rgba(255,255,255,.1);
      --panel-strong:rgba(255,255,255,.18);
      --text:rgba(247,241,255,.97);
      --muted:rgba(236,221,255,.82);
      --accent:#9d7fb6;
      --accent-strong:#8d6ea7;
      --accent2:#71527e;
      --accent3:#57385d;
      --accent4:#402950;
      --accent5:#1f1241;
      --danger:rgba(255,110,110,.95);
      --ok:rgba(120,255,180,.95);
      --glass:backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);
      --panel-glow:0 12px 40px rgba(0,0,0,.35),0 0 50px rgba(157,127,182,.18),0 0 0 1px rgba(255,255,255,.08);
    }
    html,body{
      height:100%;margin:0;overflow:hidden;
      background:url("/background.png") center/cover no-repeat fixed;
      font-family:"Inter",-apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      letter-spacing:.1px;
    }
    #wrap{position:fixed;inset:0}
    canvas{position:absolute;inset:0;width:100%;height:100%;display:block;background:transparent;opacity:1;mix-blend-mode:normal}
    .screen{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none;padding:16px}
    .panel{
      pointer-events:auto;width:min(960px,calc(100vw - 24px));
      padding:20px;border-radius:28px;
      background:linear-gradient(160deg,rgba(22,13,52,.64),rgba(44,24,88,.42));
      border:1px solid var(--glass-edge);
      box-shadow:var(--panel-glow);
      backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
      position:relative;overflow:hidden;
    }
    .menu-header{display:flex;flex-direction:column;gap:10px;padding:10px 12px 6px;position:relative;z-index:1;align-items:center;text-align:center}
    .title-pill{
      padding:14px 20px;border-radius:999px;border:1px solid rgba(255,255,255,.18);
      background:linear-gradient(120deg,rgba(255,255,255,.22),rgba(255,255,255,.12));
      box-shadow:0 12px 30px rgba(0,0,0,.28),0 0 36px rgba(157,127,182,.22);
      display:inline-flex;align-items:center;justify-content:center;width:min(720px,100%);
    }
    .title{
      font-weight:900;letter-spacing:.9px;line-height:1.05;
      font-size:clamp(46px,5.8vw,76px);margin:0;
      text-shadow:
        0 12px 38px rgba(0,0,0,.42),
        0 0 24px rgba(200,230,255,.42),
        0 0 58px rgba(157,127,182,.32);
      background:linear-gradient(120deg,#fff,#f3e9ff,#d8caff);
      -webkit-background-clip:text;color:transparent;
      filter:drop-shadow(0 6px 10px rgba(0,0,0,.22));
    }
    .title::first-letter{font-size:1.04em}
    .sub{color:var(--muted);font-size:15px;line-height:1.55;margin:0;max-width:720px;text-shadow:0 8px 24px rgba(0,0,0,.36)}
    .hero-inputs{display:flex;flex-direction:column;gap:12px;align-items:center;margin-top:6px;width:min(640px,100%);padding:10px 12px;border-radius:18px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);box-shadow:0 10px 26px rgba(0,0,0,.28)}
    .input-row{width:100%;display:grid;grid-template-columns:1fr auto;gap:10px}
    .input-row.single{grid-template-columns:1fr}
    .menu-shell{display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:start;padding:6px;margin-top:12px}
    @media (max-width: 900px){ .menu-shell{grid-template-columns:1fr} .title-pill{min-width:0} }
    .card{
      border-radius:18px;border:1px solid var(--panel-strong);background:rgba(255,255,255,.08);
      padding:14px 14px 12px;box-shadow:0 14px 34px rgba(0,0,0,.32),0 0 38px rgba(157,127,182,.14);
      backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
    }
    .card-soft{background:rgba(255,255,255,.07);border-color:rgba(255,255,255,.14)}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:flex-start}
    .top-actions{gap:10px}
    button{
      appearance:none;border:1px solid rgba(255,255,255,.2);background:linear-gradient(180deg,rgba(255,255,255,.16),rgba(255,255,255,.08));
      color:var(--text);padding:12px 16px;border-radius:16px;font-weight:900;font-size:16px;cursor:pointer;
      box-shadow:0 12px 26px rgba(0,0,0,.32),0 0 0 1px rgba(255,255,255,.05),0 0 32px rgba(157,127,182,.22);
      transition:transform .08s ease,box-shadow .14s ease,background .16s ease,translate .08s ease;
    }
    button:hover{background:linear-gradient(180deg,rgba(255,255,255,.22),rgba(255,255,255,.1));transform:translateY(-1px);box-shadow:0 16px 32px rgba(0,0,0,.3),0 0 0 1px rgba(255,255,255,.12),0 0 38px rgba(157,127,182,.26)}
    button:active{transform:translateY(0);translate:0 1px}
    button.primary{border-color:rgba(255,255,255,.28);background:linear-gradient(180deg,rgba(157,127,182,.65),rgba(113,82,126,.52));color:#0d0718;box-shadow:0 18px 40px rgba(0,0,0,.42),0 0 0 1px rgba(255,255,255,.1),0 0 42px rgba(157,127,182,.34)}
    button.primary:hover{background:linear-gradient(180deg,rgba(157,127,182,.8),rgba(141,110,167,.58))}
    button[disabled]{opacity:.58;cursor:not-allowed;transform:none;translate:0}
    button:focus-visible,input:focus-visible,select:focus-visible{
      outline:2px solid rgba(200,180,255,.9);outline-offset:2px;box-shadow:0 0 0 4px rgba(200,180,255,.25)
    }
    .pill{display:inline-flex;gap:8px;align-items:center;font-size:13px;color:var(--muted);
      border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.1);padding:8px 12px;border-radius:999px;box-shadow:0 10px 22px rgba(0,0,0,.28),0 0 26px rgba(157,127,182,.18)}
    .dot{width:9px;height:9px;border-radius:999px;background:rgba(255,200,120,.95);box-shadow:0 0 14px rgba(255,200,120,.35)}
    .pill.ok .dot{background:var(--ok);box-shadow:0 0 14px rgba(120,255,180,.35)}
    .pill.bad .dot{background:var(--danger);box-shadow:0 0 14px rgba(255,110,110,.35)}
    .pill.neutral .dot{background:rgba(170,170,170,.9);box-shadow:0 0 14px rgba(170,170,170,.25)}
    .stats{margin-top:8px;padding-top:10px;border-top:1px solid rgba(255,255,255,.12);color:var(--muted);font-size:13.8px;line-height:1.55}
    .kbd{display:inline-block;padding:2px 7px;border-radius:10px;border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.1);color:rgba(255,255,255,.96);font-weight:900;font-size:13px;box-shadow:inset 0 1px 0 rgba(255,255,255,.06)}
    .hidden{display:none!important}

    .field{display:flex;flex-direction:column;gap:6px}
    .lbl{font-size:12px;color:rgba(255,255,255,.8);font-weight:800;letter-spacing:.35px;text-transform:uppercase}
    input[type="text"], select{
      appearance:none;width:100%;padding:12px 13px;border-radius:14px;border:1px solid rgba(255,255,255,.18);
      background:linear-gradient(140deg,rgba(255,255,255,.1),rgba(255,255,255,.02));color:rgba(255,255,255,.97);font-weight:800;outline:none;
      box-shadow:inset 0 2px 12px rgba(0,0,0,.26),0 0 24px rgba(157,127,182,.12);
    }
    input[type="text"]::placeholder{color:rgba(255,255,255,.45)}
    select{background-position:right 12px center;background-size:14px 14px;background-repeat:no-repeat}
    .minirow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .hint{font-size:12.5px;color:rgba(255,255,255,.7);line-height:1.4}
    .hint.good{color:rgba(120,255,160,.82)}
    .hint.bad{color:rgba(255,110,110,.88)}
    .hint.warn{color:rgba(255,210,120,.9)}
    .section-title{font-weight:900;letter-spacing:.45px;font-size:15px;margin-bottom:6px;color:#eef6ff}
    .soft-divider{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.22),transparent);margin:10px 0}

    .hs-card{position:relative;overflow:hidden}
    .hs-card::before{
      content:"";position:absolute;inset:-16% 14% auto -10%;height:150px;
      background:radial-gradient(circle at 16% 60%,rgba(255,255,255,.08),transparent 40%),
                 radial-gradient(circle at 60% 30%,rgba(180,220,255,.1),transparent 45%);
      filter:blur(18px);opacity:.9;pointer-events:none;
    }
    .hsTable{width:100%;border-collapse:collapse;font-size:13.5px}
    .hsTable th,.hsTable td{padding:9px 8px;border-bottom:1px solid rgba(255,255,255,.1);text-align:left}
    .hsTable th{color:rgba(255,255,255,.8);font-weight:950}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}

    .bindList{display:flex;flex-direction:column;gap:8px;margin-top:6px}
    .bindRow{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;
      padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.2);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06)}
    .bindName{font-weight:900;letter-spacing:.2px}
    .bindKey{justify-self:end}
    .bindBtn{padding:8px 11px;border-radius:10px;font-size:13px}
    .bindRow.listen{border-color:rgba(160,220,255,.5);box-shadow:0 0 0 3px rgba(160,220,255,.16) inset}

    .tab-toggle{display:flex;gap:12px;align-items:center;padding:10px 14px}
    .tab-toggle label{
      padding:11px 18px;border-radius:14px;font-weight:800;cursor:pointer;border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.07);color:var(--muted);transition:all .12s ease;box-shadow:0 10px 22px rgba(0,0,0,.25)
    }
    .tab-toggle label:hover{color:var(--text);border-color:rgba(255,255,255,.14);transform:translateY(-1px)}
    .tab-radio{position:absolute;opacity:0;pointer-events:none}
    #viewMain:checked ~ .tab-toggle label[for="viewMain"]{background:linear-gradient(180deg,rgba(200,235,255,.42),rgba(140,200,255,.2));color:#0c1826;border-color:rgba(200,235,255,.82);box-shadow:0 12px 28px rgba(0,0,0,.32)}
    #viewSettings:checked ~ .tab-toggle label[for="viewSettings"]{background:linear-gradient(180deg,rgba(200,235,255,.42),rgba(140,200,255,.2));color:#0c1826;border-color:rgba(200,235,255,.82);box-shadow:0 12px 28px rgba(0,0,0,.32)}

    .view-area{position:relative}
    .tab-panel{display:none;animation:floatIn .28s ease;min-height:280px}
    #viewMain:checked ~ .menu-shell .view-area .panel-main{display:grid}
    #viewSettings:checked ~ .menu-shell .view-area .panel-settings{display:grid}
    .panel-main{grid-template-columns:1fr;gap:16px}
    .panel-settings{grid-template-columns:1fr;gap:14px}

    .info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .hero-grid{grid-template-columns:repeat(auto-fit,minmax(320px,1fr))}
    .info-card{border-radius:18px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:14px 14px 12px;box-shadow:0 12px 30px rgba(0,0,0,.26),0 0 36px rgba(157,127,182,.12)}
    .info-card .lbl{font-size:12.5px}
    .howto{font-size:13.5px;line-height:1.55;color:var(--muted)}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:7px 11px;border-radius:999px;background:rgba(255,255,255,.12);color:var(--text);font-weight:800;font-size:12px;border:1px solid rgba(255,255,255,.16);box-shadow:0 6px 16px rgba(0,0,0,.2)}
    .pills-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .compact{font-size:12.5px;color:var(--muted)}
    .volume-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
    .slider-row{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.09)}
    input[type="range"]{
      -webkit-appearance:none;appearance:none;width:100%;height:8px;border-radius:999px;background:linear-gradient(90deg,rgba(160,220,255,.9),rgba(167,139,255,.9));
      box-shadow:inset 0 1px 2px rgba(0,0,0,.4);outline:none
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;appearance:none;width:18px;height:18px;border-radius:50%;
      background:#fdfdff;border:2px solid rgba(160,220,255,.9);box-shadow:0 6px 12px rgba(0,0,0,.25)
    }
    input[type="range"]::-moz-range-thumb{
      width:18px;height:18px;border-radius:50%;background:#fdfdff;border:2px solid rgba(160,220,255,.9);box-shadow:0 6px 12px rgba(0,0,0,.25)
    }
    .mute-row{display:flex;align-items:center;gap:10px;font-weight:800;color:var(--text);padding:8px 10px;border-radius:12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.09)}
    .muted-note{font-size:12px;color:rgba(255,255,255,.65);margin-top:4px}

    .howto-card{display:grid;grid-template-columns:1fr;gap:6px}
    .mini-card{padding:12px;border-radius:14px;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);box-shadow:inset 0 1px 0 rgba(255,255,255,.08)}

    .light-aurora{position:absolute;inset:-12% -8%;background:
      radial-gradient(60% 50% at 20% 30%,rgba(157,127,182,.2),transparent),
      radial-gradient(50% 40% at 80% 10%,rgba(141,110,167,.22),transparent),
      radial-gradient(60% 50% at 70% 80%,rgba(64,41,80,.2),transparent);
      filter:blur(32px);opacity:.85;pointer-events:none;z-index:0;mix-blend-mode:screen}
    .content-layer{position:relative;z-index:1}
    .glow-mask{
      position:absolute;inset:-30%;background:
        radial-gradient(40% 36% at 20% 30%,rgba(157,127,182,.12),transparent),
        radial-gradient(32% 42% at 70% 18%,rgba(141,110,167,.18),transparent),
        radial-gradient(40% 44% at 62% 72%,rgba(64,41,80,.18),transparent);
      filter:blur(38px);opacity:.9;pointer-events:none;mix-blend-mode:screen;z-index:0;
    }
    .swatch-row{display:flex;flex-wrap:wrap;gap:10px;margin:12px 0 6px}
    .swatch{flex:1 1 120px;min-width:120px;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:14px;
      background:linear-gradient(130deg,var(--swatch),rgba(255,255,255,.12));
      color:#120b2a;font-weight:900;font-size:13px;border:1px solid rgba(255,255,255,.16);box-shadow:0 8px 22px rgba(0,0,0,.24)}
    .swatch span{color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.2)}
    .trail-preview{position:relative;width:100%;border-radius:16px;border:1px solid rgba(255,255,255,.16);background:rgba(12,7,24,.45);overflow:hidden;box-shadow:0 12px 28px rgba(0,0,0,.3),0 0 30px rgba(157,127,182,.2)}
    .trail-preview canvas{width:100%;height:100%;display:block}
    .trail-preview-label{position:absolute;top:8px;right:10px;font-size:12px;font-weight:900;letter-spacing:.3px;color:rgba(255,255,255,.8);padding:4px 8px;border-radius:10px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.12)}
    .pill.note{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.18)}
    .stack{gap:10px}
    .split-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;align-items:start}
    .overlay-card{position:relative;overflow:hidden}
    .overlay-card::after{
      content:"";position:absolute;inset:-38% 32% auto -24%;height:180px;
      background:radial-gradient(circle at 30% 50%,rgba(255,255,255,.2),transparent 45%),
                 radial-gradient(circle at 70% 40%,rgba(200,180,255,.22),transparent 48%);
      filter:blur(18px);opacity:.7;pointer-events:none;
    }
    .tiny-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;font-weight:900}
    .hero-pills{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .hero-grid .howto-card{margin-top:12px}
    @keyframes floatIn{
      from{opacity:0;transform:translateY(8px)}
      to{opacity:1;transform:translateY(0)}
    }
  </style>
</head>
<body>
<div id="wrap">
  <canvas id="c"></canvas>

  <div id="menu" class="screen">
    <div class="panel">
      <div class="glow-mask"></div>
      <div class="light-aurora"></div>
      <div class="content-layer">
        <div class="menu-header">
          <div class="title-pill"><div class="title">Flappy Bingus</div></div>
          <p class="sub">
            A dreamy flight through neon skies. Register, pick a trail, and fly. Softer glass with a brighter background keeps the clouds visible.
          </p>
        </div>

        <div class="hero-inputs">
          <div class="input-row">
            <input id="usernameInput" type="text" maxlength="18" placeholder="3–18 chars: letters, numbers, space, _ or -"/>
            <button id="saveUserBtn">Save</button>
          </div>
          <div class="hint" id="userHint" style="width:100%;text-align:left">Not signed in.</div>
          <div class="input-row">
            <select id="trailSelect"></select>
            <div class="pill note" style="justify-content:center;min-width:120px"><span class="dot"></span><span class="tiny-label">Live preview</span></div>
          </div>
          <div class="trail-preview">
            <canvas id="trailPreviewCanvas" width="320" height="140" aria-label="Trail preview canvas"></canvas>
            <div class="trail-preview-label">Preview</div>
          </div>
          <div class="hint" id="trailHint" style="width:100%;text-align:left">Unlock trails by improving your personal best.</div>
          <div class="pills-row" style="width:100%">
            <div class="badge">Personal best <span class="kbd" id="pbText">0</span></div>
            <div class="badge">Trail <span class="kbd" id="trailText">classic</span></div>
          </div>
        </div>

        <div class="menu-shell">
          <div class="card card-soft">
            <div class="section-title">Ready to fly</div>
            <div class="row top-actions" style="justify-content:center">
              <button id="start" class="primary" disabled style="min-width:140px">Start</button>
              <button id="tutorial" disabled style="min-width:140px">Tutorial</button>
              <button id="seedRandomBtn" style="min-width:140px">Random Seed</button>
            </div>
            <div class="row" style="justify-content:center;margin-top:8px">
              <div id="bootPill" class="pill"><span class="dot"></span><span id="bootText">Loading…</span></div>
            </div>
            <div class="soft-divider"></div>
            <div class="howto-card mini-card">
              <div class="section-title">How to play</div>
              <div class="howto">
                <div class="compact">Move with <span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span>. Orbs award points and combo; if any orb despawns the combo breaks.</div>
                <div class="compact">Perfect Thread: drift through the exact center of a gap as it crosses you.</div>
                <div class="compact">Practice in Tutorial, then Start when the sky calls.</div>
              </div>
            </div>
            <details class="mini-card" style="margin-top:10px">
              <summary class="section-title" style="cursor:pointer">More settings</summary>
              <div class="field" style="margin-top:6px">
                <div class="lbl">Seed (optional)</div>
                <div class="minirow">
                  <input id="seedInput" type="text" maxlength="48" placeholder="Leave blank for random (share seed to play same level)"/>
                </div>
                <div id="seedHint" class="hint">If two players use the same seed, pipe/orb spawns will match.</div>
              </div>
              <div class="soft-divider"></div>
              <div class="volume-grid">
                <div class="slider-row">
                  <div class="lbl">Music Volume</div>
                  <input type="range" min="0" max="100" value="70" aria-label="Music volume"/>
                </div>
                <div class="slider-row">
                  <div class="lbl">SFX Volume</div>
                  <input type="range" min="0" max="100" value="80" aria-label="SFX volume"/>
                </div>
              </div>
              <div class="mute-row">
                <input type="checkbox" id="muteToggle" aria-label="Mute audio"/>
                <label for="muteToggle" style="cursor:pointer">Mute everything</label>
              </div>
              <div class="muted-note">Audio controls are in progress – coming soon.</div>
              <div class="soft-divider"></div>
              <div class="section-title">Skill Keybinds</div>
              <div id="bindWrap" class="bindList"></div>
              <div id="bindHint" class="hint">Click Rebind, then press a key or click a mouse button. Press Esc to cancel.</div>
            </details>
          </div>

          <div class="card hs-card">
            <div class="row" style="margin-top:0;justify-content:space-between;gap:10px">
              <div style="font-weight:950;letter-spacing:.3px;font-size:15px;color:#eef6ff">High Scores</div>
              <a href="/highscores" style="color:var(--accent-strong);text-decoration:none;font-weight:900;font-size:13px">Full list</a>
            </div>
            <div style="height:6px"></div>
            <div id="hsWrap" class="hint">Loading leaderboard…</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="over" class="screen hidden">
    <div class="panel">
      <div class="title" style="color:var(--danger)">GAME OVER</div>
      <p class="sub">One collision = instant death. Gameplay is frozen.</p>
      <div class="stats">
        Final score: <span class="kbd" id="final">0</span><br/>
        Personal best: <span class="kbd" id="overPB">0</span>
      </div>
    <div class="row" style="margin-top:14px">
     <button id="restart">Restart (new seed)</button>
    <button id="retrySeed">Retry Previous Seed</button>
     <button id="toMenu">Main Menu</button>
     <button id="watchReplay">Watch Replay</button>
     <button id="exportGif" display="none" disabled>Export GIF</button>
     <button id="exportMp4" display="none" disabled>Export MP4</button>
   </div>

<div id="replayStatus" class="hint" style="margin-top:10px">Replay will be available after a run.</div>
      </div>
      <div class="stats">Shortcuts: <span class="kbd">R</span> restart, <span class="kbd">Esc</span> menu.</div>
    </div>
  </div>
</div>

<script type="module" src="/js/main.js"></script>
</body>
</html>
